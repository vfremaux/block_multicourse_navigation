define(["jquery","core/config","core/log"],function(a,b,c){var d={currentcourseid:0,init:function(b){a(".block_multicourse_navigation .node-course .handle").on("click",this.togglecoursestate),c.debug("Block course modulenavigation course control initialized"),a(".block_multicourse_navigation .node-section .handle").on("click",this.togglesectionstate),c.debug("Block course modulenavigation section control initialized"),a(".multicourse-controls").on("click",this.processglobal),d.currentcourseid=b},processglobal:function(c){c.stopPropagation(),c.preventDefault();var d=a(this),e=/multicourse-([a-z]+)-(\d+)/,f=e.exec(d.attr("id")),g=f[1],h=f[2],i=b.wwwroot+"/blocks/multicourse_navigation/ajax/service.php?";switch(i+="blockid="+h,i+="&what="+g,g){case"collapseall":a(".section-content.block-"+h).css("display","none"),a(".section-content.block-"+h).css("visibility","hidden");break;case"expandall":a(".section-content.block-"+h).css("display","block"),a(".section-content.block-"+h).css("visibility","visible");break;case"showmodules":a(".section-content.block-"+h+" .activities").css("display","block"),a(".section-content.block-"+h+" .activities").css("visibility","visible");break;case"hidemodules":a(".section-content.block-"+h+" .activities").css("display","none"),a(".section-content.block-"+h+" .activities").css("visibility","hidden")}a.get(i)},togglecoursestate:function(e){e.stopPropagation(),e.preventDefault();var f=a(this),g=/node-course-([0-9]+)-block-([0-9]+)/;c.debug("Courseid "+d.currentcourseid),c.debug("Elm "+f.parent().attr("id"));var h=g.exec(f.parent().attr("id"));if(h){var i,j=parseInt(h[1]),k=parseInt(h[2]);c.debug("Working for block "+k+" in course "+j);var l=b.wwwroot+"/blocks/multicourse_navigation/ajax/stateregister.php?";l+="id="+d.currentcourseid,l+="&item=course",l+="&itemid="+j,l+="&blockid="+k;var m=a("#node-course-"+j+"-block-"+k+" .handle > img").attr("src");return"visible"===a("#course-content-"+j).css("visibility")?(a("#course-content-"+j).css("visibility","hidden"),a("#course-content-"+j).css("display","none"),m=m.replace("expanded","collapsed"),a("#node-course-"+j+"-block-"+k+" .handle > img").attr("src",m),i=1):(a("#course-content-"+j).css("visibility","visible"),a("#course-content-"+j).css("display","block"),m=m.replace("collapsed","expanded"),a("#node-course-"+j+"-block-"+k+" .handle > img").attr("src",m),i=0),l+="&hide="+i,a.get(l,function(){}),!1}},togglesectionstate:function(e){e.stopPropagation(),e.preventDefault();var f,g=a(this),h=/node-block-([0-9]+)-section-([0-9]+)/;c.debug("Courseid "+d.currentcourseid),c.debug("Elm "+g.parent().attr("id"));var i=h.exec(g.parent().attr("id"));if(i){var j=parseInt(i[1]),k=parseInt(i[2]);c.debug("Working for block "+j+" and section "+k);var l=b.wwwroot+"/blocks/multicourse_navigation/ajax/stateregister.php?";l+="id="+d.currentcourseid,l+="&item=section",l+="&itemid="+k,l+="&blockid="+j;var m=a("#node-block-"+j+"-section-"+k+" .handle > img").attr("src");return"visible"===a("#section-content-"+k).css("visibility")?(a("#section-content-"+k).css("visibility","hidden"),a("#section-content-"+k).css("display","none"),m=m.replace("expanded","collapsed"),a("#node-block-"+j+"-section-"+k+" .handle > img").attr("src",m),f=1):(a("#section-content-"+k).css("visibility","visible"),a("#section-content-"+k).css("display","block"),m=m.replace("collapsed","expanded"),a("#node-block-"+j+"-section-"+k+" .handle > img").attr("src",m),f=0),l+="&hide="+f,a.get(l,function(){}),!1}}};return d});