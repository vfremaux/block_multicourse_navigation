define(["jquery","core/config","core/log"],function(a,b,c){var d;return{init:function(b){a(".block_multicourse_navigation .node-course .handle").on("click",this.togglecoursestate),c.debug("Block course modulenavigation course control initialized"),a(".block_multicourse_navigation .node-section .handle").on("click",this.togglesectionstate),c.debug("Block course modulenavigation section control initialized"),a(".multicourse-controls").on("click",this.processglobal),d=b},processglobal:function(c){c.stopPropagation(),c.preventDefault();var d=a(this);switch(regex=/multicourse-([a-z]+)-(\d+)/,matchs=regex.exec(d.attr("id")),what=matchs[1],blockid=matchs[2],url=b.wwwroot+"/blocks/multicourse_navigation/ajax/service.php?",url+="blockid="+blockid,url+="&what="+what,what){case"collapseall":a(".section-content.block-"+blockid).css("display","none"),a(".section-content.block-"+blockid).css("visibility","hidden");break;case"expandall":a(".section-content.block-"+blockid).css("display","block"),a(".section-content.block-"+blockid).css("visibility","visible");break;case"showmodules":a(".section-content.block-"+blockid+" .activities").css("display","block"),a(".section-content.block-"+blockid+" .activities").css("visibility","visible");break;case"hidemodules":a(".section-content.block-"+blockid+" .activities").css("display","none"),a(".section-content.block-"+blockid+" .activities").css("visibility","hidden")}a.get(url)},togglecoursestate:function(e){e.stopPropagation(),e.preventDefault();var f=a(this);if(regex=/node-course-([0-9]+)-block-([0-9]+)/,c.debug("Courseid "+d),c.debug("Elm "+f.parent().attr("id")),matchs=regex.exec(f.parent().attr("id")),matchs)return courseid=parseInt(matchs[1]),blockid=parseInt(matchs[2]),c.debug("Working for block "+blockid+" in course "+courseid),url=b.wwwroot+"/blocks/multicourse_navigation/ajax/stateregister.php?",url+="id="+d,url+="&item=course",url+="&itemid="+courseid,url+="&blockid="+blockid,handlesrc=a("#node-course-"+courseid+"-block-"+blockid+" .handle > img").attr("src"),"visible"===a("#course-content-"+courseid).css("visibility")?(a("#course-content-"+courseid).css("visibility","hidden"),a("#course-content-"+courseid).css("display","none"),handlesrc=handlesrc.replace("expanded","collapsed"),a("#node-course-"+courseid+"-block-"+blockid+" .handle > img").attr("src",handlesrc),hide=1):(a("#course-content-"+courseid).css("visibility","visible"),a("#course-content-"+courseid).css("display","block"),handlesrc=handlesrc.replace("collapsed","expanded"),a("#node-course-"+courseid+"-block-"+blockid+" .handle > img").attr("src",handlesrc),hide=0),url+="&hide="+hide,a.get(url,function(a){}),!1},togglesectionstate:function(e){e.stopPropagation(),e.preventDefault();var f=a(this);if(regex=/node-block-([0-9]+)-section-([0-9]+)/,c.debug("Courseid "+d),c.debug("Elm "+f.parent().attr("id")),matchs=regex.exec(f.parent().attr("id")),matchs)return blockid=parseInt(matchs[1]),sectionid=parseInt(matchs[2]),c.debug("Working for block "+blockid+" and section "+sectionid),url=b.wwwroot+"/blocks/multicourse_navigation/ajax/stateregister.php?",url+="id="+d,url+="&item=section",url+="&itemid="+sectionid,url+="&blockid="+blockid,handlesrc=a("#node-block-"+blockid+"-section-"+sectionid+" .handle > img").attr("src"),"visible"===a("#section-content-"+sectionid).css("visibility")?(a("#section-content-"+sectionid).css("visibility","hidden"),a("#section-content-"+sectionid).css("display","none"),handlesrc=handlesrc.replace("expanded","collapsed"),a("#node-block-"+blockid+"-section-"+sectionid+" .handle > img").attr("src",handlesrc),hide=1):(a("#section-content-"+sectionid).css("visibility","visible"),a("#section-content-"+sectionid).css("display","block"),handlesrc=handlesrc.replace("collapsed","expanded"),a("#node-block-"+blockid+"-section-"+sectionid+" .handle > img").attr("src",handlesrc),hide=0),url+="&hide="+hide,a.get(url,function(a){}),!1}}});